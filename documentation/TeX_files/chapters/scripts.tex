/chapter{Scripts And Tools}






\section{Create Effect Combinations}
\subsection{Overview}
The \texttt{create\_effect\_combinations.py} script is a Python 3 tool designed to generate all possible combinations of a sentence or set of sentences by replacing placeholders with values defined in external text files. It is ideal for creating permutations of text templates, such as game effects, test cases, or parameterized strings, where placeholders (e.g., \texttt{<rank>}) represent variable elements. The tool supports nested placeholders, numeric offsets (e.g., \texttt{<rank+1>}), and configurable post-processing to clean, filter, and refine the output.

This script automates the generation of exhaustive text combinations, with output that can be written to a file or displayed in the terminal. Configuration files enhance flexibility by allowing users to customize filtering and phrase replacements without modifying the source code.

\subsection{Purpose}
The \texttt{create\_effect\_combinations.py} script aims to streamline the creation of text variations from templates. Common use cases include:
\begin{itemize}
    \item Generating card or spell effects for games (e.g., "Draw \texttt{<number>} cards").
    \item Producing test data for software validation.
    \item Creating parameterized strings for simulations or documentation.
\end{itemize}
By leveraging recursive placeholder resolution and user-defined configuration files, it ensures comprehensive and polished results with minimal manual effort.

\subsection{Features}
The tool provides the following key features:
\begin{itemize}
    \item \textbf{Placeholder Substitution}: Replaces placeholders (e.g., \texttt{<rank>}) with values from text files in a specified directory (default: \texttt{placeholders/}).
    \item \textbf{Nested Placeholder Support}: Recursively resolves nested placeholders (e.g., \texttt{<effect>} containing \texttt{<number>}).
    \item \textbf{Offset Handling}: Adjusts numeric placeholders with offsets (e.g., \texttt{<rank+1>}, \texttt{<rank-1>}).
    \item \textbf{Input Flexibility}: Processes a single sentence (\texttt{-s}) or a file of sentences (\texttt{-f}, default: \texttt{effects/all\_effect\_templates.txt}).
    \item \textbf{Output Customization}: Writes combinations to a file (default: \texttt{effects/all\_effects.txt}) or outputs to the terminal in test mode (\texttt{-t}).
    \item \textbf{Configurable Post-Processing}:
        \begin{itemize}
            \item Removes duplicates, preserving the order of first appearance.
            \item Filters out unwanted phrases defined in a configuration file (default: \texttt{placeholders/combinations\_to\_remove.txt}).
            \item Replaces phrases with designated alternatives from a configuration file (default: \texttt{placeholders/phrase\_replacements.txt}).
            \item Alphabetizes the final list for readability.
        \end{itemize}
    \item \textbf{Deduplication Utility}: Offers a standalone mode (\texttt{-d}) to remove duplicate lines from a file.
    \item \textbf{Error Handling}: Manages missing files, empty inputs, and recursive placeholder cycles (unresolved as, e.g., \texttt{<rank>}).
\end{itemize}

\subsection{Configuration Files}
The script uses two configuration files to customize post-processing, both supporting comments (lines starting with \texttt{\#}) for documentation or disabling rules:
\begin{itemize}
    \item \textbf{\texttt{placeholders/combinations\_to\_remove.txt}}:
        \begin{itemize}
            \item \textit{Purpose}: Specifies phrases to exclude from the generated combinations, such as invalid or undesirable outputs.
            \item \textit{Format}: One phrase per line. Empty lines and comments (\texttt{\#}) are ignored.
            \item \textit{Example}:
\begin{lstlisting}
1 or lower
# Exclude higher ranks for now
5 or higher
spell creature
\end{lstlisting}
            \item \textit{Effect}: Combinations containing these phrases (e.g., "Draw 1 or lower cards") are filtered out.
        \end{itemize}
    \item \textbf{\texttt{placeholders/phrase\_replacements.txt}}:
        \begin{itemize}
            \item \textit{Purpose}: Defines phrase replacements to refine grammar or correct errors in the output.
            \item \textit{Format}: Key-value pairs in the form \texttt{old phrase: new phrase}, one per line. Empty lines and comments (\texttt{\#}) are ignored.
            \item \textit{Example}:
\begin{lstlisting}
# Fix pluralization
one point(s): one point
two card(s): two cards
# Temporary disable this:
# three spell(s): three spells
spellscaster: spellcaster
\end{lstlisting}
            \item \textit{Effect}: Replaces matching phrases (e.g., "one point(s)" becomes "one point") in all combinations.
        \end{itemize}
\end{itemize}
Both files are optional; if missing, the script proceeds without filtering or replacements, respectively, and issues a warning.

\subsection{Usage}
Invoke the script via the command line:
\begin{lstlisting}[language=bash]
python3 create_effect_combinations.py [-s SENTENCE | -f FILE] [-p DIR] [-o OUT] [-t] [-d [FILE]] [-c CONFIG] [-r REPLACEMENTS]
\end{lstlisting}
Key arguments include:
\begin{itemize}
    \item \texttt{-s/--sentence}: Process a single sentence (e.g., "Draw \texttt{<number>} cards").
    \item \texttt{-f/--file}: Process a file of sentences (default: \texttt{effects/all\_effect\_templates.txt}).
    \item \texttt{-p/--placeholder\_dir}: Directory with placeholder files (default: \texttt{placeholders}).
    \item \texttt{-o/--output\_file}: Output file (default: \texttt{effects/all\_effects.txt}).
    \item \texttt{-t/--test\_mode}: Display results in terminal instead of writing to a file.
    \item \texttt{-d/--dedupe}: Deduplicate a file and exit (default: \texttt{effects/all\_effects.txt}).
    \item \texttt{-c/--combinations\_to\_remove}: File listing phrases to remove (default: \texttt{placeholders/combinations\_to\_remove.txt}).
    \item \texttt{-r/--replacements\_file}: File with phrase replacements (default: \texttt{placeholders/phrase\_replacements.txt}).
\end{itemize}
Exactly one of \texttt{-s} or \texttt{-f} must be provided.

\subsection{Example}
With \texttt{placeholders/number.txt}:
\begin{lstlisting}
1
2
3
\end{lstlisting}
And \texttt{placeholders/combinations\_to\_remove.txt}:
\begin{lstlisting}
# Exclude invalid draw
Draw 1
\end{lstlisting}
And \texttt{placeholders/phrase\_replacements.txt}:
\begin{lstlisting}
two card: two cards
\end{lstlisting}
Running:
\begin{lstlisting}[language=bash]
python3 create_effect_combinations.py -s "Draw <number> card" -t
\end{lstlisting}
Outputs:
\begin{lstlisting}
Draw 2 cards
Draw 3 card
Total combinations: 2
\end{lstlisting}

\subsection{Requirements}
\begin{itemize}
    \item Python 3.x
    \item Placeholder files in the specified directory (e.g., \texttt{number.txt}).
    \item Optional: Configuration files for filtering and replacements.
\end{itemize}

\subsection{Limitations}
\begin{itemize}
    \item Offset calculations assume numeric values; non-numeric values are unchanged.
    \item Recursive placeholder cycles are detected but result in unresolved placeholders (e.g., \texttt{<rank>}).
    \item Additional grammar fixes beyond configuration files are hardcoded in the script.
\end{itemize}








\section{Add CSV Field}
\subsection{Overview}
The \texttt{add\_csv\_field.py} script is a Python 3 tool designed to process text or CSV files containing effects (e.g., game card descriptions) and generate or update a CSV file with a custom column indicating whether each effect matches a specified pattern or substring. It supports two modes: pattern matching with placeholder expansion (e.g., \texttt{<number> cards}) and exact substring matching. The script integrates with a directory of placeholder files to resolve patterns dynamically, making it versatile for analyzing structured text data.

This tool is particularly useful for annotating datasets, such as marking effects that contain specific keywords or structures, and outputs results in a semicolon-delimited CSV format for easy integration with other tools or analysis workflows.

\subsection{Purpose}
The \texttt{add\_csv\_field.py} script aims to automate the annotation of effects by adding or updating a boolean column in a CSV file based on user-defined criteria. Common use cases include:
\begin{itemize}
    \item Tagging game effects that match specific patterns (e.g., "Draw \texttt{<number>} cards") for categorization.
    \item Validating or auditing text data by marking entries with exact substrings.
    \item Preparing datasets for further processing or analysis by adding metadata columns.
\end{itemize}
By leveraging placeholder resolution and flexible input handling, it simplifies the task of identifying and labeling patterns in text.

\subsection{Features}
The script offers the following key features:
\begin{itemize}
    \item \textbf{Dual Input Support}: Processes plain text files (one effect per line) or semicolon-delimited CSV files with an \texttt{EFFECTNAME} column.
    \item \textbf{Pattern Matching}: Checks for patterns with placeholders (e.g., \texttt{Destroy <number> cards}), expanding them using values from placeholder files in a specified directory (default: \texttt{placeholders/}).
    \item \textbf{Exact Substring Matching}: Sets a column to \texttt{True} for effects containing an exact substring (e.g., \texttt{Draw two}).
    \item \textbf{Column Management}: Adds a new column if it doesnâ€™t exist or updates an existing column, setting \texttt{True} where matches occur (preserving \texttt{True} values in updates).
    \item \textbf{Placeholder Resolution}: Recursively resolves nested placeholders in patterns, using the same logic as \texttt{create\_effect\_combinations.py}.
    \item \textbf{Output Format}: Generates a semicolon-delimited CSV with at least two columns: \texttt{EFFECTNAME} and the user-specified column.
    \item \textbf{Error Handling}: Manages missing files, invalid columns, and recursive placeholder cycles (unresolved as, e.g., \texttt{<number>}).
\end{itemize}

\subsection{Usage}
Invoke the script via the command line:
\begin{lstlisting}[language=bash]
python3 add_csv_field.py -i INPUT -o OUTPUT -c COLUMN [-p DIR] [-t TEXT | -e EXACT]
\end{lstlisting}
Key arguments include:
\begin{itemize}
    \item \texttt{-i/--input}: Input file (text or CSV) with effects (default: \texttt{effects/effects\_with\_placeholders.csv}).
    \item \texttt{-o/--output}: Output CSV file (default: \texttt{effects/effects\_with\_placeholders.csv}).
    \item \texttt{-c/--column}: Name of the column to add or update (required, e.g., \texttt{HasDraw}).
    \item \texttt{-p/--placeholder\_dir}: Directory with placeholder files (default: \texttt{placeholders}).
    \item \texttt{-t/--text}: Pattern to match, including placeholders (e.g., \texttt{Draw <number> cards}).
    \item \texttt{-e/--exact}: Exact substring to match (e.g., \texttt{Draw two}).
\end{itemize}
Exactly one of \texttt{-t} or \texttt{-e} must be provided.

\subsection{Example}
\subsubsection{Pattern Matching}
With \texttt{placeholders/number.txt}:
\begin{lstlisting}
1
2
3
\end{lstlisting}
And input file \texttt{effects.txt}:
\begin{lstlisting}
Draw 2 cards
Gain 5 life
Draw 1 creature
\end{lstlisting}
Running:
\begin{lstlisting}[language=bash]
python3 add_csv_field.py -i effects.txt -o output.csv -c HasDraw -t "Draw <number>"
\end{lstlisting}
Outputs \texttt{output.csv}:
\begin{lstlisting}
EFFECTNAME;HasDraw
Draw 2 cards;True
Gain 5 life;False
Draw 1 creature;True
\end{lstlisting}

\subsubsection{Exact Match}
With input CSV \texttt{effects.csv}:
\begin{lstlisting}
EFFECTNAME;HasDraw
Draw two cards;False
Gain life;False
\end{lstlisting}
Running:
\begin{lstlisting}[language=bash]
python3 add_csv_field.py -i effects.csv -o updated.csv -c HasDraw -e "Draw two"
\end{lstlisting}
Outputs \texttt{updated.csv}:
\begin{lstlisting}
EFFECTNAME;HasDraw
Draw two cards;True
Gain life;False
\end{lstlisting}

\subsection{Requirements}
\begin{itemize}
    \item Python 3.x
    \item Placeholder files in the specified directory (e.g., \texttt{number.txt}) for pattern matching with \texttt{-t}.
\end{itemize}

\subsection{Limitations}
\begin{itemize}
    \item For \texttt{-e/--exact}, the specified column must already exist in CSV inputs; otherwise, an error occurs.
    \item Recursive placeholder cycles in patterns are detected but result in unresolved placeholders (e.g., \texttt{<number>}).
    \item Assumes semicolon (\texttt{;}) as the CSV delimiter; other delimiters are not supported.
    \item Non-CSV inputs are converted to CSV with a default \texttt{EFFECTNAME} column.
\end{itemize}
